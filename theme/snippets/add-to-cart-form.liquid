<form id="add-to-cart-form">
    <template v-for="(option,i) in form.options">
        <div>
            {% render 'product-option-row' %}
        </div>
    </template>
    <button @click="addToCart" type="submit" name="add" id="add-to-cart-button" :key="1">Add to cart</button>
</form>

<script>
    if (document.querySelector('#add-to-cart-form')) {
        const productForm = Vue.createApp({
            delimiters: ['${', '}'], // vuejs uses same notation {{}} as liquid, thats we why we doing this
            data() {
                return {
                    open: false,
                    variant: "",
                    selected: [],
                    form: {
                        selections: "",
                        options: ""
                    }
                }
            },
            created() {
                axios.get('/products/{{ product.handle }}.js')
                    .then(results => {
                        console.log("get products results...", results)
                        this.form.options = results.data.options.map(item => ({ ...item, visible: false }))
                        this.variants = results.data.variants
                        results.data.options.map(item => this.selected.push(item.values[0]))
                        this.form.selections = [
                            this.selected[0] ? this.selected[0] : null,
                            this.selected[1] ? this.selected[1] : null,
                            this.selected[2] ? this.selected[2] : null
                        ]
                    })
            },
            methods: {
                addToCart(event) {
                    event.preventDefault()

                    let data = {
                        id: this.variant,
                        quantity: 1
                    }
                    // https://shopify.dev/api/ajax/reference/cart
                    axios.post('/cart/add.js', data)
                        .then((response) => {
                            console.log("add to cart response...", response)
                        })
                        .catch(error => {
                            console.log(error)
                        })
                }
            }
        }).mount('#add-to-cart-form')
    }
</script>